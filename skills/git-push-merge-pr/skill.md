---
name: git-push-merge-pr
description: Stage, commit, push changes to your fork and create a PR to upstream/stage. Works across any repository you're working in.
allowed-tools: Bash, AskUserQuestion, TodoWrite
---

# Git Push & Merge PR Skill

## Purpose

Quickly push your local changes to your fork and create a PR to upstream's `stage` branch. This is a one-command workflow for your daily development across multiple repos.

## Triggers

- `/git-push-merge-pr` - Stage all, commit, push, and create PR
- `/git-push-merge-pr -m "commit message"` - With custom commit message
- `/git-push-merge-pr --no-pr` - Push only, don't create PR

### Examples

```bash
# Standard workflow - stages, commits, pushes, creates PR
/git-push-merge-pr

# With custom commit message
/git-push-merge-pr -m "fix: resolve header alignment issue"

# Just push, skip PR creation
/git-push-merge-pr --no-pr

# Push to a different upstream branch
/git-push-merge-pr --base develop
```

---

## Prerequisites

- GitHub CLI (`gh`) authenticated
- You must be in a git repository
- Remote `origin` should point to YOUR fork
- Remote `upstream` should point to the original repo (optional - will auto-detect)

---

## Workflow

### Step 1: Verify Git Status

```bash
# Check we're in a git repo
git rev-parse --is-inside-work-tree

# Get current branch name
git branch --show-current

# Check for changes
git status --porcelain
```

If no changes exist, inform the user and exit.

### Step 2: Detect Repository Setup

```bash
# Get remote URLs
git remote -v

# Determine upstream and origin
# origin = your fork (where you push)
# upstream = original repo (where PR goes)
```

**Auto-detection logic:**
1. If `upstream` remote exists → use it for PR target
2. If only `origin` exists → detect if it's a fork using `gh repo view --json parent`
3. If origin is a fork → use parent as PR target
4. If origin is NOT a fork → user is working directly on the repo, PR goes to same repo

### Step 3: Show Status and Confirm

Display current status:

```
═══════════════════════════════════════════════════════════════════════════════
GIT PUSH PREVIEW
═══════════════════════════════════════════════════════════════════════════════

Repository: mobile-web-client
Branch: TTN-12345-fix-header
Origin (your fork): yashkumarverma/mobile-web-client
Upstream (PR target): LambdatestIncPrivate/mobile-web-client
Target branch: stage

Changes to be committed:
  M  src/components/Header.tsx
  M  src/styles/header.css
  A  src/utils/newHelper.ts

───────────────────────────────────────────────────────────────────────────────
```

### Step 4: Get Commit Message

If `-m` flag provided, use that message.

Otherwise, ask user:

```
question: "Enter commit message (or leave empty for auto-generated)"
header: "Commit"
options:
  - label: "Auto-generate from changes"
    description: "Generate a commit message based on the staged changes"
  - label: "Enter custom message"
    description: "You'll be prompted to enter a message"
```

**Auto-generate logic:**
- Analyze changed files
- Create conventional commit message like:
  - `fix: update Header component styles`
  - `feat: add newHelper utility`
  - `chore: multiple file updates`

### Step 5: Execute Git Operations

```bash
# Stage all changes
git add .

# Commit with message
git commit -m "<commit-message>"

# Push to origin (your fork)
git push origin <current-branch> --set-upstream
```

**Handle push failures:**
- If branch doesn't exist on remote → `git push -u origin <branch>`
- If rejected (behind remote) → ask user if they want to force push or pull first

### Step 6: Create Pull Request (unless --no-pr)

```bash
# Check if PR already exists
gh pr list --head <your-username>:<branch> --repo <upstream-repo> --json number,url

# If no existing PR, create one
gh pr create \
  --repo <upstream-repo> \
  --head <your-username>:<current-branch> \
  --base stage \
  --title "<pr-title>" \
  --body "<pr-body>"
```

**PR Title Generation:**
- If branch follows `TTN-XXXXX-description` format → `TTN-XXXXX: <description>`
- Otherwise use commit message as title

**PR Body Template:**

```markdown
## Summary
<Auto-generated from commit messages or branch name>

## Changes
- List of changed files

## Testing
- [ ] Tested locally
- [ ] Ready for review

---
Generated with `/git-push-merge-pr`
```

### Step 7: Summary Report

```
═══════════════════════════════════════════════════════════════════════════════
PUSH COMPLETE
═══════════════════════════════════════════════════════════════════════════════

✓ Changes staged (3 files)
✓ Committed: "fix: update Header component styles"
✓ Pushed to: yashkumarverma/mobile-web-client (branch: TTN-12345-fix-header)
✓ PR Created: https://github.com/LambdatestIncPrivate/mobile-web-client/pull/1234

Next steps:
1. Wait for CI to pass
2. Request review
3. Merge when approved

───────────────────────────────────────────────────────────────────────────────
```

---

## Commands Reference

| Command | Description |
|---------|-------------|
| `/git-push-merge-pr` | Full workflow: stage, commit, push, create PR |
| `/git-push-merge-pr -m "message"` | With custom commit message |
| `/git-push-merge-pr --no-pr` | Push only, skip PR creation |
| `/git-push-merge-pr --base <branch>` | PR to different base branch (default: stage) |
| `/git-push-merge-pr --draft` | Create PR as draft |
| `/git-push-merge-pr --force` | Force push (use with caution) |

---

## Flags

| Flag | Short | Description | Default |
|------|-------|-------------|---------|
| `--message` | `-m` | Custom commit message | Auto-generate |
| `--no-pr` | | Skip PR creation | false |
| `--base` | `-b` | Target branch for PR | `stage` |
| `--draft` | `-d` | Create draft PR | false |
| `--force` | `-f` | Force push | false |
| `--title` | `-t` | Custom PR title | From branch/commit |

---

## Repository Detection

The skill automatically detects your repository setup:

### Scenario 1: Fork with upstream remote

```
origin    git@github.com:yashkumarverma/mobile-web-client.git
upstream  git@github.com:LambdatestIncPrivate/mobile-web-client.git
```
→ Push to `origin`, PR to `upstream/stage`

### Scenario 2: Fork without upstream remote

```
origin    git@github.com:yashkumarverma/mobile-web-client.git
```
→ Detect parent via `gh repo view --json parent`
→ Push to `origin`, PR to parent's `stage`

### Scenario 3: Direct repo access (not a fork)

```
origin    git@github.com:LambdatestIncPrivate/mobile-web-client.git
```
→ Push to `origin`, PR within same repo to `stage`

---

## Error Handling

### No Changes to Commit

```
No changes detected in working directory.
Nothing to push.
```

### Not in a Git Repository

```
Error: Not in a git repository.
Please navigate to a git repository and try again.
```

### Push Rejected (Behind Remote)

```
Push rejected - your branch is behind the remote.

Options:
1. Pull and merge first (recommended)
2. Force push (will overwrite remote)
3. Cancel
```

### PR Already Exists

```
A PR already exists for this branch:
https://github.com/LambdatestIncPrivate/mobile-web-client/pull/1230

Changes have been pushed. The existing PR has been updated.
```

### No Upstream Detected

```
Could not detect upstream repository.
Please specify the target repo:

Options:
1. LambdatestIncPrivate/mobile-web-client
2. Enter manually
3. Skip PR creation
```

---

## Branch Naming Convention

The skill works best with these branch naming patterns:

| Pattern | Example | PR Title |
|---------|---------|----------|
| `TTN-XXXXX-description` | `TTN-12345-fix-header` | `TTN-12345: fix header` |
| `FORCE-XXXX-description` | `FORCE-1234-add-feature` | `FORCE-1234: add feature` |
| `fix/description` | `fix/header-alignment` | `fix: header alignment` |
| `feat/description` | `feat/new-dashboard` | `feat: new dashboard` |
| `chore/description` | `chore/update-deps` | `chore: update deps` |

---

## Example Session

```
User: /git-push-merge-pr -m "fix: resolve header z-index issue"

═══════════════════════════════════════════════════════════════════════════════
GIT PUSH PREVIEW
═══════════════════════════════════════════════════════════════════════════════

Repository: mobile-web-client
Branch: TTN-98765-header-fix
Origin: yashkumarverma/mobile-web-client
Upstream: LambdatestIncPrivate/mobile-web-client
Target: stage

Changes (2 files):
  M  src/components/Header/Header.tsx
  M  src/components/Header/Header.module.css

Commit message: "fix: resolve header z-index issue"

───────────────────────────────────────────────────────────────────────────────

Proceed with push and PR creation?
[Yes, proceed] [Edit message] [Cancel]

> Yes, proceed

Staging changes...     ✓
Committing...          ✓
Pushing to fork...     ✓
Creating PR...         ✓

═══════════════════════════════════════════════════════════════════════════════
COMPLETE
═══════════════════════════════════════════════════════════════════════════════

PR: https://github.com/LambdatestIncPrivate/mobile-web-client/pull/1234
Branch: TTN-98765-header-fix → stage

───────────────────────────────────────────────────────────────────────────────
```

---

## Safety Features

1. **Preview before action** - Always shows what will be committed/pushed
2. **Confirmation required** - Won't push without user confirmation
3. **No force push by default** - Must explicitly use `--force` flag
4. **Existing PR detection** - Won't create duplicate PRs
5. **Branch protection** - Won't push to protected branches directly
6. **Clean commit history** - Each push is a single, clean commit

---

## Notes

- Works with any repository, not just LambdaTest repos
- Automatically handles fork detection
- Compatible with SSH and HTTPS remotes
- Respects `.gitignore` when staging
- Uses conventional commit format when auto-generating messages
